{% extends 'base.html' %}
{% block title %}User Dashboard{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-3">Welcome, {{ user.full_name }}</h2>
  <p>Your email: {{ user.email }}</p>

  <div class="mb-3">
    <a href="{{ url_for('book_slot') }}" class="btn btn-primary">Book Parking Slot</a>
    <a href="{{ url_for('booking_history') }}" class="btn btn-secondary">View Booking History</a>
    {% if active_booking and active_booking.status == 'Booked' %}
        <form method="POST" action="{{ url_for('release_slot', reservation_id=active_booking.id) }}" class="mt-3">
            <button type="submit" class="btn btn-danger">Release Spot</button>
        </form>
    {% else %}
        <span class="text-muted mt-3 d-block">Released</span>
    {% endif %} 
  </div>

  {% if latest_booking %}
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Last Booking Summary</h5>
      <p><strong>Spot ID:</strong> {{ latest_booking.spot_id }}</p>
      <p><strong>Start:</strong> {{ latest_booking.parking_time }}</p>
      <p><strong>Cost:</strong> â‚¹{{ latest_booking.cost }}</p>
    </div>
  </div>
  {% endif %}

  <div class="row">
    <div class="col-md-6 mb-4">
      <div class="card p-3 shadow-sm">
        <h5>Bookings Over Time</h5>
        <canvas id="bookingsChart"></canvas>
      </div>
    </div>
    <div class="col-md-6 mb-4">
      <div class="card p-3 shadow-sm">
        <h5>Cost Over Time</h5>
        <canvas id="costChart"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- JSON Data -->
<script>
  const bookingDates = {{ booking_dates | safe }};
  const bookingCounts = {{ booking_counts | safe }};
  const costDates = {{ cost_dates | safe }};
  const dailyCosts = {{ daily_costs | safe }};
</script>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/user_charts.js') }}"></script>

{% endblock %}



